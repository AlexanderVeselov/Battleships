/*#SDTREF(SDL,C:\Telelogic\SDL_TTCN_Suite4.3\sdt\include\ADT\ctypes.sun,4)*/
PACKAGE ctypes;
/*#SDTREF(SDL,C:\Telelogic\SDL_TTCN_Suite4.3\sdt\include\ADT\ctypes.sun(1),119(25,40))*/

/* Copyright (C) 1994 - 2000 by Telelogic AB.
Copyright (C) 1991, 1992, 1993, 1994 by Telelogic Malmoe AB.
Copyright (C) 1990, 1991 by Telesoft Europe AB.
This Program is owned by Telelogic and is protected by national
copyright laws and international copyright treaties. Telelogic
grants you the right to use this Program on one computer or in
one local computer network at any one time.
Under this License you may only modify the source code for the purpose
of adapting it to your environment. You must reproduce and include
any copyright and trademark notices on all copies of the source code.
You may not use, copy, merge, modify or transfer the Program except as
provided in this License.
Telelogic does not warrant that the Program will meet your
requirements or that the operation of the Program will be
uninterrupted and error free. You are solely responsible that the
selection of the Program and the modification of the source code
will achieve your intended results and that the results are actually
obtained. */

/*--------------------------- ShortInt --------------------------*/
/* Corresponds to C types : short int, short                     */
/*---------------------------------------------------------------*/

SYNTYPE ShortInt = Integer

/*#ADT(T A(S) E(S))
#TYPE
typedef short int #(ShortInt);
*/
ENDSYNTYPE ShortInt;



/*--------------------------- LongInt ---------------------------*/
/* Corresponds to C types : long int, long                       */
/*---------------------------------------------------------------*/

SYNTYPE LongInt = Integer

/*#ADT(T A(S) E(S))
#TYPE
typedef long int #(LongInt);
*/
ENDSYNTYPE LongInt;



/*---------------------- UnsignedShortInt -----------------------*/
/* Corresponds to C types : unsigned short int, unsigned short   */
/*---------------------------------------------------------------*/

SYNTYPE UnsignedShortInt = Integer

/*#ADT(T A(S) E(S))
#TYPE
typedef unsigned short #(UnsignedShortInt);
*/
ENDSYNTYPE UnsignedShortInt;



/*------------------------- UnsignedInt -------------------------*/
/* Corresponds to C types : unsigned int, unsigned               */
/*---------------------------------------------------------------*/

SYNTYPE UnsignedInt = Integer
/*#ADT(T A(S) E(S))
#TYPE
typedef unsigned #(UnsignedInt);
*/
ENDSYNTYPE UnsignedInt;



/*----------------------- UnsignedLongInt -----------------------*/
/* Corresponds to C types : unsigned long int, unsigned long     */
/*---------------------------------------------------------------*/

SYNTYPE UnsignedLongInt = Integer

/*#ADT(T A(S) E(S))
#TYPE
typedef unsigned long #(UnsignedLongInt);
*/
ENDSYNTYPE UnsignedLongInt;



/*--------------------------- Float -----------------------------*/
/* Corresponds to C type : float                                 */
/*---------------------------------------------------------------*/

SYNTYPE Float = Real
/*#ADT(T A(S) E(S))
#TYPE
#ifndef XNOUSEOFREAL
typedef float #(Float);
#define Float #(Float)
#endif
*/
ENDSYNTYPE Float;

/*-------------------------- Charstar ---------------------------*/
/* Corresponds to C type : char *                                */
/*---------------------------------------------------------------*/

NEWTYPE Charstar
  LITERALS
    Null                            /*#OP(S)*/;
  OPERATORS
    cstar2cstring : Charstar   -> Charstring;  /* NOT in Cmicro */
    cstring2cstar : Charstring -> Charstar;    /* NOT in Cmicro */
    cstar2vstar   : Charstar   -> Voidstar;
    vstar2cstar   : Voidstar   -> Charstar;
    cstar2vstarstar : Charstar -> Voidstarstar;/*#OP(HP)*/ /*To be used with free*/
  DEFAULT Null;
/*#ADT(T A(S) E(S) H)
#TYPE
typedef char * #(Charstar);
#HEADING
#define #(Null)()       0
#ifndef XSCT_CMICRO
extern SDL_Charstring #(cstar2cstring) XPP((#(Charstar)));
extern #(Charstar) #(cstring2cstar) XPP((SDL_Charstring));
#endif
#define #(cstar2vstar)(P) ((#(Voidstar))P)
#define #(vstar2cstar)(P) ((#(Charstar))P)
#define #(cstar2vstarstar)(P) ((#(Voidstarstar))&P)

#BODY
#ifndef XSCT_CMICRO
extern SDL_Charstring #(cstar2cstring)(
  #(Charstar) C)
{
  SDL_Charstring Result;
  int i = 0;
  if (C != 0) i = strlen(C);
  Result = (SDL_Charstring)XALLOC(i+2, (tSDLTypeInfo *)&ySDL_SDL_Charstring);
  if (i>0) memcpy(Result+1, C, i);
  Result[0] = 'T';
  Result[i+1] = '\0';
  return Result;
}

extern #(Charstar) #(cstring2cstar)(
  SDL_Charstring C)
{
  #(Charstar) Result;
  int i;
  if (C == (SDL_Charstring)0)
    i = 0;
  else
    i = strlen(C)-1;
#ifdef XVALIDATOR_LIB
  Result = (#(Charstar))XALLOC_REF_VAL(i+1, ySrtN_#(Charstar));
#else
  Result = (#(Charstar))XALLOC(i+1, (tSDLTypeInfo *)&ySDL_#(Charstar));
#endif
  if (i>0) memcpy(Result, C+1, i);
  Result[i] = '\0';
  if (C != 0 && C[0] == 'T')
    xFree_SDL_Charstring((void **)&C);
  return Result;
}
#endif
*/
ENDNEWTYPE Charstar;


/*-------------------------- Voidstar ---------------------------*/
/* Corresponds to C type : void *                                */
/*---------------------------------------------------------------*/

NEWTYPE Voidstar
  LITERALS
    Null                            /*#OP(S)*/;
  DEFAULT Null;
/*#ADT(T A(S) E(S) D(H) W(S) R(S))
#TYPE
typedef void * #(Voidstar);
#HEADING
#define #(Null)()       0
*/
ENDNEWTYPE Voidstar;


/*------------------------ Voidstarstar -------------------------*/
/* Corresponds to C type : void **                               */
/*---------------------------------------------------------------*/

NEWTYPE Voidstarstar
  LITERALS
     Null                            /*#OP(S)*/,
     Alloc                           /*#OP(H)*/;
  OPERATORS
    "*>"  : Voidstarstar, Voidstar -> Voidstarstar; /*#OP(SI)*/
    "*>"  : Voidstarstar -> Voidstar;               /*#OP(SI)*/
    "&"  : Voidstar -> Voidstarstar;                /*#OP(SI)*/
    "+"  : Voidstarstar, Integer -> Voidstarstar;   /*#OP(SI)*/
    "-"  : Voidstarstar, Integer -> Voidstarstar;   /*#OP(SI)*/
    vstarstar2vstar : Voidstarstar -> Voidstar;     /*#OP(HP)*/
    vstar2vstarstar : Voidstar -> Voidstarstar;     /*#OP(HP)*/
  DEFAULT Null;
/*#ADT(T A(S) E(S))
#TYPE
typedef void ** #(Voidstarstar);
#HEADING
#define yExtr_#(Voidstarstar)(yVar)  (*(yVar))
#define yAddr_#(Voidstarstar)(yVar)  (*(yVar))
#define #(Null)()       0
#define #(Alloc)() (#0)XALLOC(sizeof(Voidstar), (tSDLTypeInfo *)&ySDL_#(Voidstarstar))
#define #(vstarstar2vstar)(P) ((#(Voidstar))P)
#define #(vstar2vstarstar)(P) ((#(Voidstarstar))P)
*/
ENDNEWTYPE Voidstarstar;


/*--------------------------- CArray ----------------------------*/
/* Corresponds to C arrays                                       */
/*---------------------------------------------------------------*/

GENERATOR Carray (CONSTANT Length, TYPE Itemsort)
  OPERATORS
    modify!  : Carray, Integer, Itemsort -> Carray;
    extract! : Carray, Integer           -> Itemsort;
ENDGENERATOR Carray;



/*---------------------------- Ref ------------------------------*/
/* Corresponds to C pointers                                     */
/*---------------------------------------------------------------*/

GENERATOR Ref (TYPE Itemsort)
  LITERALS
     Null,
     Alloc;
  OPERATORS
    "*>"  : Ref, Itemsort -> Ref;
    "*>"  : Ref -> Itemsort;
    "&"   : Itemsort -> Ref;
    make! : Itemsort -> Ref;
    free  : in/out Ref;
    "+"   : Ref, Integer -> Ref;
    "-"   : Ref, Integer -> Ref;
    ref2vstar : Ref -> Voidstar;
    vstar2ref : Voidstar -> Ref;
    ref2vstarstar : Ref /*#REF*/ -> Voidstarstar;
  DEFAULT Null;
ENDGENERATOR Ref;

procedure free /*#NAME 'XXFREE'*/; fpar p Voidstarstar; external;
/*#CODE
#HEADING
#ifdef XVALIDATOR_LIB
#define XXFREE(p) XFREE_REF_VAL(p,0)
#else
#define XXFREE(p) XFREE(p,0)
#endif
*/


/*#SDTREF(SDL,C:\Telelogic\SDL_TTCN_Suite4.3\sdt\include\ADT\ctypes.sun,4)*/
endpackage ctypes;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun,4)*/
package BasicTypes;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),245(40,25))*/
/*#include 'C:\Battleships\Config\ConfigFile.pr' */
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),278(20,40))*/
syntype tSCRange = Integer
  constants 0:MaxSCRange
endsyntype;
syntype tSCMaxSpeed = Integer
  constants 0:MaxSCMaxSpeed
endsyntype;
syntype tSCMaxAcceleration = Integer
  constants 0:MaxSCMaxAcceleration
endsyntype;
syntype tSCMaxResource = Integer
  constants 0:MaxSCMaxResource
endsyntype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),188(80,40))*/
syntype tWCPower = Integer
  constants 0:MaxWCPower
endsyntype;
syntype tWCRange = Integer
  constants 0:MaxWCRange
endsyntype;
syntype tWCSpeed = Integer
  constants 0:MaxWCSpeed
endsyntype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),281(80,75))*/
syntype tAAWeaponry = Integer
  constants 0:MaxAAWeaponry
endsyntype;
syntype tLUWeaponry = Integer
  constants 0:MaxLUWeaponry
endsyntype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),290(20,85))*/
syntype tXCoordinate = Integer
  constants -1:MaxXCoordinate+1
endsyntype;
syntype tYCoordinate = Integer
  constants -1:MaxYCoordinate+1
endsyntype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),374(80,100))*/
syntype tFactorAcceleration = Real
  constants -1.0:1.0
endsyntype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),407(20,110))*/
syntype tShipId = Integer
  constants 1:(MaxTypeBattleship + 
               MaxTypeCruiser + 
               MaxTypeDestroyer + 
               MaxTypeMissileCutter + 
               MaxTypeRepairBoat) *
               AmountStrategy
endsyntype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),413(80,115))*/
syntype tStrategyId = Integer
  constants 1:AmountStrategy
endsyntype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(1),455(80,130))*/
synonym sqrt2  Real = 1.41421356;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(2),254(20,40))*/
newtype tHeading
  literals
    NORTH,
    NORTH_EAST,
    EAST,
    SOUTH_EAST,
    SOUTH,
    SOUTH_WEST,
    WEST,
    NORTH_WEST;
  operators
    h2i : tHeading -> Integer;
    i2h : Integer -> tHeading;
  operator h2i;
    fpar lit tHeading;
    returns Integer; referenced;
  operator i2h;
    fpar int Integer;
    returns tHeading; referenced;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(2),182(70,40))*/
newtype tDeep
  literals
    LAND,
    FLEET,
    NORMAL,
    DEEPLY,
    VERY_DEEPLY;
  operators
    d2i : tDeep -> Integer;
    i2d : Integer -> tDeep;
  operator d2i;
    fpar lit tDeep;
    returns Integer; referenced;
  operator i2d;
    fpar int Integer;
    returns tDeep; referenced;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(2),179(20,115))*/
newtype tNameWeaponry
  literals
    MISSILE,
    TORPEDO,
    SHELL,
    REPAIR;
  operators
    nw2i : tNameWeaponry -> Integer;
    i2nw : Integer -> tNameWeaponry;
  operator nw2i;
    fpar lit tNameWeaponry;
    returns Integer; referenced;
  operator i2nw;
    fpar int Integer;
    returns tNameWeaponry; referenced;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(2),248(80,115))*/
newtype tNameShip
  literals
    BATTLESHIP,
    CRUISER,
    DESTROYER,
    MISSILE_CUTTER,
    REPAIR_BOAT;
  operators
    ns2i : tNameShip -> Integer;
    i2ns : Integer -> tNameShip;
  operator ns2i;
    fpar lit tNameShip;
    returns Integer; referenced;
  operator i2ns;
    fpar int Integer;
    returns tNameShip; referenced;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(2),359(20,175))*/
newtype tHeadingChange
  literals
    LEFT,
    RIGHT;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(3),287(20,40))*/
newtype tCoordinates
  struct
    x tXCoordinate;
    y tYCoordinate;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(3),146(20,60))*/
newtype tWeaponryCharacter
  struct
    Power tWCPower;
    Range tWCRange;
    Speed tWCSpeed;      
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(3),251(20,85))*/
newtype tShipCharacter
  struct
    Range tSCRange;
    MaxSpeed tSCMaxSpeed;
    MaxAcceleration tSCMaxAcceleration;
    MaxResource tSCMaxResource;
    MaxAmmunition tArrayAmountAmmunition;
    MaxLaunchUnit tArrayAmountLaunchUnit;
    MaxDeep tDeep;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(3),401(20,125))*/
newtype tShipCurrentState
  struct
    ShipId tShipId;
    StrategyId tStrategyId;
    TypeShip tNameShip;
    Speed tSCMaxSpeed;
    Heading tHeading;
    Resource tSCMaxResource;
    Coordinates tCoordinates;
    Ammunition tArrayAmountAmmunition;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(3),446(20,180))*/
newtype tEnemyShip
  struct
    ShipId tShipId;
    StrategyId tStrategyId;
    TypeShip tNameShip;
    Speed tSCMaxSpeed;
    Heading tHeading;
    Coordinates tCoordinates;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(4),215(20,40))*/
newtype tArrayWeaponryCharacter
  Array(tNameWeaponry,tWeaponryCharacter);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(4),284(20,55))*/
newtype tArrayShipsCharacter
  Array(tNameShip,tShipCharacter);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(4),344(20,70))*/
newtype tArrayAmountAmmunition
  Array(tNameWeaponry,tAAWeaponry);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(4),341(20,85))*/
newtype tArrayAmountLaunchUnit
  Array(tNameWeaponry,tLUWeaponry);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(4),404(20,100))*/
newtype tStringShipCurrentState
  String(tShipCurrentState,empty);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(4),449(20,115))*/
newtype tStringEnemyShip
  String(tEnemyShip,empty);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(4),362(20,130))*/
newtype tStringShotsList
  String(tCoordinates,empty);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(5),329(20,40))*/
remote gWeaponryCharacter tArrayWeaponryCharacter;
remote gShipsCharacter tArrayShipsCharacter;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(5),410(20,55))*/
procedure getDeepXY;
  fpar
    x tXCoordinate,
    y tYCoordinate;
  returns Integer;
external;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(5),452(20,80))*/
procedure getDistance;
  fpar
    xps Integer,
    yps Integer,
    xpf Integer,
    ypf Integer;
  returns Integer;
external;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(6),233(20,40))*/
signal
  InitDataComplete,
  StartSimulation(Integer),
  FinishSimulation(Integer,tStrategyId),
  OrderSpeedRequest(tShipId,tStrategyId,tFactorAcceleration),
  OrderTurnRequest(tShipId,tStrategyId,tHeadingChange),
  OrderFireRequest(tShipId,tStrategyId,tNameWeaponry,tStringShotsList),
  DestroyShip(tShipId,tStrategyId,tNameShip),
  StrategyVictory(tStrategyId),
  StrategyLose(tStrategyId),
  OrderSpeedResponse(tShipId,tStrategyId),
  OrderSpeedReject(tShipId,tStrategyId),
  OrderTurnResponse(tShipId,tStrategyId),
  OrderTurnReject(tShipId,tStrategyId),
  OrderFireResponse(tShipId,tStrategyId),
  OrderFireReject(tShipId,tStrategyId),
  ShipsCurrentState(tStrategyId,tStringShipCurrentState),
  VisibleShip(tStrategyId,tStringEnemyShip),
  messageLog(Charstring),
  messageError(Charstring);
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(6),365(20,115))*/
signallist fromSimulator = (toStrategy);
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(6),371(80,115))*/
signallist toSimulator = (fromStrategy);
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(6),236(20,130))*/
signallist toStrategy = 
InitDataComplete,
StartSimulation,
DestroyShip,
OrderSpeedResponse,
OrderSpeedReject,
OrderTurnResponse,
OrderTurnReject,
OrderFireResponse,
OrderFireReject,
ShipsCurrentState,
VisibleShip,
StrategyVictory,
StrategyLose;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun(6),353(60,130))*/
signallist fromStrategy =
FinishSimulation,
OrderSpeedRequest,
OrderTurnRequest,
OrderFireRequest;
/*#SDTREF(SDL,C:\Battleships\Packages\BasicTypes.sun,4)*/
endpackage BasicTypes;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop,4)*/
operator h2i
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop,1)*/
; fpar
  lit tHeading;
returns Integer;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),116(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),119(80,40))*/
decision /*#E*/ 
lit;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),143(32,50))*/
(NORTH):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),128(25,55))*/
return /*#E*/ 
0;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),179(152,50))*/
(NORTH_WEST):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),167(145,55))*/
return /*#E*/ 
7;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),146(47,65))*/
(NORTH_EAST):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),134(40,70))*/
return /*#E*/ 
1;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),176(137,65))*/
(WEST):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),158(130,70))*/
return /*#E*/ 
6;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),149(62,80))*/
(EAST):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),137(55,85))*/
return /*#E*/ 
2;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),173(122,80))*/
(SOUTH_WEST):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),164(115,85))*/
return /*#E*/ 
5;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),152(77,95))*/
(SOUTH_EAST):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),140(70,100))*/
return /*#E*/ 
3;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),170(107,95))*/
(SOUTH):
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),155(100,100))*/
return /*#E*/ 
4;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop(1),119(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\h2i.sop,4)*/
endoperator h2i;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop,4)*/
operator i2h
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop,1)*/
; fpar
  int Integer;
returns tHeading;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),143(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),140(80,40))*/
decision /*#E*/ 
int mod 8 ;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),149(32,50))*/
(=0):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),137(25,55))*/
return /*#E*/ 
NORTH;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),152(152,50))*/
(=7):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),134(145,55))*/
return /*#E*/ 
NORTH_WEST;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),155(47,65))*/
(=1):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),131(40,70))*/
return /*#E*/ 
NORTH_EAST;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),158(137,65))*/
(=6):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),128(130,70))*/
return /*#E*/ 
WEST;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),161(62,80))*/
(=2):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),125(55,85))*/
return /*#E*/ 
EAST;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),164(122,80))*/
(=5):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),122(115,85))*/
return /*#E*/ 
SOUTH_WEST;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),167(77,95))*/
(=3):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),119(70,100))*/
return /*#E*/ 
SOUTH_EAST;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),170(107,95))*/
(=4):
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),116(100,100))*/
return /*#E*/ 
SOUTH;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop(1),140(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\i2h.sop,4)*/
endoperator i2h;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop,4)*/
operator d2i
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop,1)*/
; fpar
  lit tDeep;
returns Integer;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),143(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),140(80,40))*/
decision /*#E*/ 
lit;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),149(57,52))*/
(LAND):
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),137(50,55))*/
return /*#E*/ 
0;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),152(127,50))*/
(VERY_DEEPLY):
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),134(120,55))*/
return /*#E*/ 
4;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),155(72,65))*/
(FLEET):
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),131(65,70))*/
return /*#E*/ 
1;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),158(112,65))*/
(DEEPLY):
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),128(105,70))*/
return /*#E*/ 
3;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),170(92,80))*/
(NORMAL):
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),116(85,85))*/
return /*#E*/ 
2;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop(1),140(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\d2i.sop,4)*/
endoperator d2i;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop,4)*/
operator i2d
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop,1)*/
; fpar
  int Integer;
returns tDeep;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),143(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),140(80,40))*/
decision /*#E*/ 
int mod 5;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),149(60,50))*/
(=0):
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),137(50,55))*/
return /*#E*/ 
LAND;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),152(127,50))*/
(=4):
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),134(120,55))*/
return /*#E*/ 
VERY_DEEPLY;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),155(72,65))*/
(=1):
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),131(65,70))*/
return /*#E*/ 
FLEET;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),158(112,65))*/
(=3):
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),128(105,70))*/
return /*#E*/ 
DEEPLY;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),161(92,80))*/
(=2):
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),125(85,85))*/
return /*#E*/ 
NORMAL;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop(1),140(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\i2d.sop,4)*/
endoperator i2d;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop,4)*/
operator nw2i
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop,1)*/
; fpar
  lit tNameWeaponry;
returns Integer;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),137(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),134(80,40))*/
decision /*#E*/ 
lit;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),143(62,50))*/
(MISSILE):
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),131(55,55))*/
return /*#E*/ 
0;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),146(122,50))*/
(REPAIR):
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),128(115,55))*/
return /*#E*/ 
3;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),149(77,65))*/
(TORPEDO):
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),125(70,70))*/
return /*#E*/ 
1;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),152(107,65))*/
(SHELL):
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),122(100,70))*/
return /*#E*/ 
2;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop(1),134(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\nw2i.sop,4)*/
endoperator nw2i;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop,4)*/
operator i2nw
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop,1)*/
; fpar
  int Integer;
returns tNameWeaponry;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),134(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),131(80,40))*/
decision /*#E*/ 
int mod 4;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),140(62,50))*/
(=0):
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),128(55,55))*/
return /*#E*/ 
MISSILE;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),143(122,50))*/
(=3):
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),125(115,55))*/
return /*#E*/ 
REPAIR;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),146(77,65))*/
(=1):
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),122(70,70))*/
return /*#E*/ 
TORPEDO;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),149(107,65))*/
(=2):
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),119(100,70))*/
return /*#E*/ 
SHELL;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop(1),131(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\i2nw.sop,4)*/
endoperator i2nw;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop,4)*/
operator ns2i
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop,1)*/
; fpar
  lit tNameShip;
returns Integer;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),134(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),131(80,40))*/
decision /*#E*/ 
lit;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),140(57,50))*/
(BATTLESHIP):
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),128(50,55))*/
return /*#E*/ 
0;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),143(127,50))*/
(REPAIR_BOAT):
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),125(120,55))*/
return /*#E*/ 
4;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),146(72,65))*/
(CRUISER):
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),122(65,70))*/
return /*#E*/ 
1;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),149(112,65))*/
(MISSILE_CUTTER):
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),119(105,70))*/
return /*#E*/ 
3;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),152(92,80))*/
(DESTROYER):
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),116(85,85))*/
return /*#E*/ 
2;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop(1),131(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\ns2i.sop,4)*/
endoperator ns2i;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop,4)*/
operator i2ns
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop,1)*/
; fpar
  int Integer;
returns tNameShip;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),134(80,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),131(80,40))*/
decision /*#E*/ 
int mod 5;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),140(57,50))*/
(=0):
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),128(50,55))*/
return /*#E*/ 
BATTLESHIP;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),143(127,50))*/
(=4):
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),125(120,55))*/
return /*#E*/ 
REPAIR_BOAT;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),146(72,65))*/
(=1):
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),122(65,70))*/
return /*#E*/ 
CRUISER;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),149(112,65))*/
(=3):
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),119(105,70))*/
return /*#E*/ 
MISSILE_CUTTER;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),152(92,80))*/
(=2):
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),116(85,85))*/
return /*#E*/ 
DESTROYER;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop(1),131(80,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\Packages\i2ns.sop,4)*/
endoperator i2ns;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy,7)*/
use ctypes;
use BasicTypes;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy,4)*/
system BattleShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy,1)*/
/*#include 'file.pr'*/
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),173(130,42))*/
channel /*#E*/ 
St2MsgInt from Strategy2 to env with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),174(150,55))*/
messageLog,
messageError;
endchannel St2MsgInt;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),137(75,77))*/
channel /*#E*/ 
SimSt2Int from Simulator to Strategy2 with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),138(97,65))*/
(toStrategy);
from Strategy2 to Simulator with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),139(97,90))*/
(fromStrategy);
endchannel SimSt2Int;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),164(132,102))*/
channel /*#E*/ 
SimMsgInt from Simulator to env with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),165(150,115))*/
messageLog,
messageError;
endchannel SimMsgInt;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),128(75,144))*/
channel /*#E*/ 
SimSt1Int from Simulator to Strategy1 with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),129(97,149))*/
(toStrategy);
from Strategy1 to Simulator with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),130(97,125))*/
(fromStrategy);
endchannel SimSt1Int;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),182(132,162))*/
channel /*#E*/ 
St1MsgInt from Strategy1 to env with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),183(150,175))*/
messageLog,
messageError;
endchannel St1MsgInt;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),125(80,40))*/
block Strategy2 referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),119(80,100))*/
block Simulator referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy(1),122(80,160))*/
block Strategy1 referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\BattleShips.ssy,4)*/
endsystem BattleShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk,4)*/
block Strategy2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),140(40,55))*/
signalroute /*#E*/ 
chStSim from env to Main with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),141(55,62))*/
(fromSimulator);
from Main to env with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),142(17,62))*/
(toSimulator);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),146(132,55))*/
signalroute /*#E*/ 
chStMsg from Main to env with 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),147(152,62))*/
messageLog,
messageError;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),137(80,50))*/
process Main referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),158(5,52))*/
connect SimSt2Int and chStSim;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk(1),167(167,52))*/
connect St2MsgInt and chStMsg;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2.sbk,4)*/
endblock Strategy2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr,4)*/
process <<block Strategy2>> Main;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),665(90,5))*/
synonym 
   MapCenterX Integer = MaxXCoordinate/2,
   MapCenterY Integer = MaxYCoordinate/2,
   MaxShipId Integer = (MaxTypeBattleship
                                  + MaxTypeCruiser
                                  + MaxTypeDestroyer
                                  + MaxTypeMissileCutter
                                  + MaxTypeRepairBoat)*AmountStrategy;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),143(5,25))*/
imported
    gWeaponryCharacter tArrayWeaponryCharacter,
    gShipsCharacter tArrayShipsCharacter;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),506(5,40))*/
newtype tOrderType
 literals
    _RIGHT,
    _LEFT,
    _FIRE,
    _ACCEL;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),830(60,40))*/
procedure ConcatStringInt;
  fpar
    str Charstring,
    val Integer;
  returns Charstring;
external;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),902(100,40))*/
newtype tCustomShipState
    struct
    ShipId tShipId;
    ReadyToFreeMotion Boolean := false;
    TargetHeading tHeading;
    PrevCoords tCoordinates;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),482(5,70))*/
newtype tFire
  struct
    List tStringShotsList;
    Weapon tNameWeaponry; 
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),863(60,70))*/
procedure ConcatStringIntInt;
  fpar
    str Charstring,
    val1 Integer,
    val2 Integer;
  returns Charstring;
external;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),905(100,70))*/
newtype tArrayCustomShipState
    Array(tShipId, tCustomShipState);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),479(5,95))*/
newtype tCommand
  struct
    OrderType  tOrderType;
    isSet Boolean;
    Fire tFire;
    Accel tFactorAcceleration;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(1),476(5,125))*/
newtype tArrayCommand
  Array(tShipId,tCommand);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),638(5,40))*/
dcl 
   WeaponryCharacter tArrayWeaponryCharacter,
   ShipsCharacter tArrayShipsCharacter;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),620(5,80))*/
dcl 
   MyCenter tCoordinates,
   Tick, NumMyShips, NumRepairShips Integer,
   HeadingTarget tCoordinates,
   ShipsCurrentState tStringShipCurrentState,
   CustomShipState tArrayCustomShipState,
   CommandToShip tArrayCommand,
   StrategyID tStrategyId,
   NumShipsInit Integer:= 0;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),635(5,145))*/
dcl
   EnemyCenter tCoordinates,
   NumVisibleShips Integer,
   EnemyShips tStringEnemyShip;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),632(85,25))*/
procedure StrategyStep2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),668(135,25))*/
/* Реализация стратегии 
для одного такта симуляции */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),629(85,40))*/
procedure EnemyCenter2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),674(135,40))*/
/* Определние центра масс 
вражеских кораблей */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),623(85,55))*/
procedure UpdateShipParams2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),680(135,55))*/
/* Инициализация данных 
о кораблях флота */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),857(85,70))*/
procedure DebugLogString referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),842(85,85))*/
procedure DebugLogStringInt referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),860(85,100))*/
procedure DebugLogStringIntInt referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),920(85,115))*/
procedure InitCustomShipState referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),914(85,130))*/
procedure SetShipReadyToFreeMotion referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),917(85,145))*/
procedure GetShipReadyToFreeMotion referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),908(85,160))*/
procedure SetShipTargetHeading referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),911(85,175))*/
procedure GetShipTargetHeading referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),929(85,190))*/
procedure SetShipPrevCoords referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),935(85,205))*/
procedure GetShipPrevCoords referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),119(70,5))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),116(70,20))*/
nextstate /*#E*/ 
Idle;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),230(120,10))*/
state /*#E*/ 
*;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),227(120,25))*/
input /*#E*/ 
 
StrategyVictory(StrategyID),
StrategyLose(StrategyID)
 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),797(110,55))*/
/* Импорт массивов с характеристиками
снарядов и кораблей */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),266(125,40))*/
stop /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),230(120,10))*/
endstate;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),116(70,20))*/
state /*#E*/ 
Idle;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),182(70,35))*/
input /*#E*/ 
InitDataComplete;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),149(55,50))*/
task {/*#E*/ 
WeaponryCharacter := import(gWeaponryCharacter);
ShipsCharacter := import(gShipsCharacter);};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),197(70,65))*/
nextstate /*#E*/ 
InitComplete;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),116(70,20))*/
endstate;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),197(70,65))*/
state /*#E*/ 
InitComplete;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),284(65,80))*/
input /*#E*/ 
ShipsCurrentState(StrategyID,
ShipsCurrentState);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),923(65,95))*/
call /*#E*/ 
InitCustomShipState;
grst120:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),551(65,110))*/
call /*#E*/ 
UpdateShipParams2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),311(70,125))*/
nextstate /*#E*/ 
IdleVisShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),584(130,80))*/
save /*#E*/ 
VisibleShip;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),197(70,65))*/
endstate;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),311(70,125))*/
state /*#E*/ 
IdleVisShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),326(45,140))*/
input /*#E*/ 
StartSimulation(Tick) ;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),206(35,155))*/
call /*#E*/ 
StrategyStep2(ShipsCurrentState);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),353(45,170))*/
output /*#E*/ 
FinishSimulation(Tick, 
StrategyID)  ;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),734(45,185))*/
nextstate /*#E*/ 
IdleRes;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),317(85,155))*/
input /*#E*/ 
VisibleShip(StrategyID,
EnemyShips);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),386(85,170))*/
call /*#E*/ 
EnemyCenter2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),329(85,185))*/
nextstate /*#E*/ 
-;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),311(70,125))*/
endstate;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),734(45,185))*/
state /*#E*/ 
IdleRes;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),749(60,200))*/
input /*#E*/ 
 
  OrderSpeedResponse, OrderSpeedReject, 
  OrderTurnResponse, OrderTurnReject, 
  OrderFireResponse, OrderFireReject, DestroyShip
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),761(60,220))*/
nextstate /*#E*/ 
-;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),869(20,205))*/
input /*#E*/ 
ShipsCurrentState(StrategyID,
ShipsCurrentState);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),938(25,220))*/
task /*#E*/ 
'';
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),551(65,110))*/
join /*#E*/ 
grst120;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(3),734(45,185))*/
endstate;

/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),641(5,25))*/
/* Характеристики кораблей 
и вооружения по типам */

/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),650(5,65))*/
/* Данные о кораблях 
своего флота */

/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr(2),653(5,125))*/
/* Данные о кораблях
вражеского флота */
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Main.spr,4)*/
endprocess <<block Strategy2>> Main;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\UpdateShipParams.spd,4)*/
procedure UpdateShipParams2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\UpdateShipParams.spd(1),224(130,10))*/
dcl
 i Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\UpdateShipParams.spd(1),116(25,20))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\UpdateShipParams.spd(1),122(25,40))*/
task {/*#E*/ 
 
NumVisibleShips := 0;
NumMyShips := length(ShipsCurrentState);
NumRepairShips := 0;
for (i:=1, i<=NumMyShips, i+1){
  CommandToShip(i)!isSet := false;
  CommandToShip(i)!Fire!List := empty;
  if (ShipsCurrentState(i)!TypeShip = REPAIR_BOAT) NumRepairShips := NumRepairShips+1;
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\UpdateShipParams.spd(1),119(30,90))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\UpdateShipParams.spd,4)*/
endprocedure UpdateShipParams2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyCenter.spd,4)*/
procedure EnemyCenter2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyCenter.spd(1),140(125,15))*/
dcl
  TempCenterX, TempCenterY Real,
   i Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyCenter.spd(1),116(10,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyCenter.spd(1),122(10,45))*/
task {/*#E*/ 
 
TempCenterX := 0;
TempCenterY := 0;
NumVisibleShips := length(EnemyShips);
for (i:=1, i<=NumVisibleShips, i+1) {
  TempCenterX := TempCenterX + float(EnemyShips(i)!Coordinates!x)/float(NumVisibleShips);
  TempCenterY := TempCenterY + float(EnemyShips(i)!Coordinates!y)/float(NumVisibleShips);
}
 EnemyCenter!x := fix(TempCenterX);
 EnemyCenter!y := fix(TempCenterY);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyCenter.spd(1),119(15,60))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyCenter.spd,4)*/
endprocedure EnemyCenter2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd,4)*/
procedure StrategyStep2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd,1)*/
; fpar
  in/out ShipsCurrState tStringShipCurrentState;

/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),254(5,30))*/
newtype tTurnDirection inherits tHeadingChange
  adding literals
     STRAIGHT;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),329(5,50))*/
newtype tCollisionType
   literals
     NO_COLLISION,
     LAND_COLLISION,
     ENEMY_SHIP_COLLISION,
     MY_SHIP_COLLISION;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),2591(40,50))*/
newtype tCollisionData
   struct
       CollisionType tCollisionType;
       CollisionPoint tCoordinates;
       WallLayout tWallLayout;
       Distance Integer;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),200(5,80))*/
dcl
   shipIndex Integer := 1,
   CollisionData tCollisionData;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),2603(5,95))*/
newtype tWallLayout
literals
    WALL_POINT,    
    WALL_HORISONTAL,
    WALL_VERTICAL,
    WALL_INNER_CORNER,
    WALL_OUTER_CORNER;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),1025(85,10))*/
procedure EnemyFound2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),887(135,10))*/
/* Реализация стратеги в условиях 
видимости вражеских кораблей */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),926(85,25))*/
procedure EnemyNotFound2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),881(135,25))*/
/* Реализация стратегии при 
отсутствии 
в поле видимости стратегии 
вражеских кораблей */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),872(85,45))*/
procedure NextPosition2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),869(135,45))*/
/* Определение прогнозируемого 
положения корабля на 
следующем такте по его текущей 
скорости, направлению и
 текущим координатам */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),866(85,65))*/
procedure NextDirection2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),863(135,65))*/
/* Определение нового 
направления корабля по 
текущему направлению и 
повороту */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),860(85,85))*/
procedure NewHeadingChange2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),857(135,85))*/
/* Определение стороны 
поворота корабля для 
координирования 
движения в сторону цели */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),854(85,105))*/
procedure CheckCollision referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),851(135,105))*/
/* Определение коллизии */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),848(85,120))*/
procedure ResolveCollision referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),845(135,120))*/
/* Разрешение коллизии */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),917(85,135))*/
procedure NextShipState2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),920(135,135))*/
/* Возвращает предсказуемое
состояние корабля
на следующем такте симуляции */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),1274(85,150))*/
procedure OutputCommand referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),1277(135,150))*/
/* Выдача команд кораблям */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),2582(85,165))*/
procedure FindHeadingTarget2 referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),2585(85,180))*/
procedure GetTurnDirection referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),2000(85,195))*/
procedure OnLand2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(1),2003(135,195))*/
/* Уход с мели */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),137(80,5))*/
start /*#E*/ 
;
grst121:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2615(45,40))*/
task {/*#E*/ 
 
call DebugLogStringInt('Ship', shipIndex);
call DebugLogStringIntInt('Coordinates', ShipsCurrState(shipIndex)!Coordinates!x,
ShipsCurrState(shipIndex)!Coordinates!y);
call DebugLogStringIntInt('Deep/maxDeep:', (call getDeepXY(ShipsCurrState(shipIndex)!Coordinates!x,
ShipsCurrState(shipIndex)!Coordinates!y)), d2i(ShipsCharacter(ShipsCurrState(shipIndex)!_
TypeShip)!MaxDeep));
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2501(45,60))*/
decision /*#E*/ 
 
(call getDeepXY(ShipsCurrState(shipIndex)!Coordinates!x,
ShipsCurrState(shipIndex)!Coordinates!y)) <
d2i(ShipsCharacter(ShipsCurrState(shipIndex)!TypeShip)!MaxDeep)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2567(65,60))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2561(100,70))*/
decision /*#E*/ 
NumVisibleShips=0;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2570(82,77))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2495(65,85))*/
call /*#E*/ 
EnemyFound2(ShipsCurrState(shipIndex));
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2573(137,77))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2558(115,85))*/
call /*#E*/ 
EnemyNotFound2(ShipsCurrState(shipIndex));
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2561(100,70))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2492(100,115))*/
task {/*#E*/ 
 
CollisionData := call CheckCollision;
if (CollisionData!CollisionType /= NO_COLLISION) {
    call ResolveCollision;
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2516(45,60))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2498(25,85))*/
call /*#E*/ 
OnLand2(ShipsCurrState(shipIndex),
shipIndex);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2501(45,60))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2480(45,135))*/
task {/*#E*/ 
call OutputCommand;
shipIndex := shipIndex + 1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2477(50,150))*/
decision /*#E*/ 
shipIndex <=
NumMyShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2546(7,40))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2552(62,162))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2471(55,170))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2477(50,150))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd(2),2615(45,40))*/
join /*#E*/ 
grst121;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\StrategyStep.spd,4)*/
endprocedure StrategyStep2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SolveCollision.spd,4)*/
procedure ResolveCollision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SolveCollision.spd(1),656(140,10))*/
dcl
ShipHeading tHeading,
ChangeDirection tTurnDirection,
ShipId tShipId;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SolveCollision.spd(1),116(60,15))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SolveCollision.spd(1),839(60,30))*/
task {/*#E*/ 
ShipHeading := ShipsCurrState(shipIndex)!Heading;
ShipId := ShipsCurrState(shipIndex)!ShipId;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SolveCollision.spd(1),641(60,50))*/
task {/*#E*/ 
 
decision (CollisionData!WallLayout) {
(WALL_VERTICAL) : {
    decision (ShipHeading) {
    (NORTH_EAST) : call SetShipTargetHeading(ShipId, NORTH_WEST);
    (NORTH_WEST) : call SetShipTargetHeading(ShipId, NORTH_EAST);
    (SOUTH_EAST) : call SetShipTargetHeading(ShipId, SOUTH_WEST);
    (SOUTH_WEST) : call SetShipTargetHeading(ShipId, SOUTH_EAST);
}
}
(WALL_HORISONTAL) : {
    decision (ShipHeading) {
    (NORTH_EAST) : call SetShipTargetHeading(ShipId, SOUTH_EAST);
    (NORTH_WEST) : call SetShipTargetHeading(ShipId, SOUTH_WEST);
    (SOUTH_EAST) : call SetShipTargetHeading(ShipId, NORTH_EAST);
    (SOUTH_WEST) : call SetShipTargetHeading(ShipId, NORTH_WEST);
}
}
(WALL_INNER_CORNER) : {
    decision (ShipHeading) {
    (NORTH_EAST) : call SetShipTargetHeading(ShipId, SOUTH_WEST);
    (NORTH_WEST) : call SetShipTargetHeading(ShipId, SOUTH_EAST);
    (SOUTH_EAST) : call SetShipTargetHeading(ShipId, NORTH_WEST);
    (SOUTH_WEST) : call SetShipTargetHeading(ShipId, NORTH_EAST);
}
}
(WALL_OUTER_CORNER) : {
    decision (ShipHeading) {
    (NORTH_EAST) : call SetShipTargetHeading(ShipId, SOUTH_WEST);
    (NORTH_WEST) : call SetShipTargetHeading(ShipId, SOUTH_EAST);
    (SOUTH_EAST) : call SetShipTargetHeading(ShipId, NORTH_WEST);
    (SOUTH_WEST) : call SetShipTargetHeading(ShipId, NORTH_EAST);
}
}
}
ChangeDirection := STRAIGHT;
if ((call GetShipTargetHeading(ShipId)) /= ShipsCurrState(shipIndex)!Heading) {
    ChangeDirection := call GetTurnDirection(ShipsCurrState(shipIndex)!Heading, call GetShipTargetHeading(ShipId));
    CommandToShip(shipIndex)!isSet := true;
}
if (ChangeDirection = RIGHT) CommandToShip(shipIndex)!OrderType := _RIGHT;
if (ChangeDirection = LEFT) CommandToShip(shipIndex)!OrderType := _LEFT;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SolveCollision.spd(1),848(65,70))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SolveCollision.spd,4)*/
endprocedure ResolveCollision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd,4)*/
procedure CheckCollision
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd,1)*/
;
returns Result tCollisionData;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),143(120,5))*/
dcl
  MyShipNextState, OtherShipNextState tShipCurrentState,
  NextPoint tCoordinates, 
  NextHead tHeading,
  IncX, IncY, i, Deep, maxDeep, blockDist, maxCheckDist Integer, 
  flag  Real := 1,
  tactCount Integer,
  MyShipType tNameShip;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2219(120,5))*/
dcl
CollisionLeft, CollisionRight, CollisionUp, CollisionDown Boolean;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),116(75,5))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),146(55,20))*/
task {/*#E*/ 
MyShipNextState := call NextShipState2(shipIndex);
NextHead := MyShipNextState!Heading;
MyShipType := ShipsCurrState(shipIndex)!TypeShip;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1745(75,40))*/
decision /*#E*/ 
NextHead;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1748(27,45))*/
(NORTH):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1742(15,50))*/
task {/*#E*/ 
IncX:=0;
IncY:=1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1817(137,45))*/
(NORTH_WEST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1691(135,50))*/
task {/*#E*/ 
IncX:=-1;
IncY:=1;
flag:=sqrt2;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1793(37,65))*/
(EAST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1703(30,70))*/
task {/*#E*/ 
IncX:=1;
IncY:=0;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1805(122,65))*/
(SOUTH_WEST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1697(120,70))*/
task {/*#E*/ 
IncX:=-1;
IncY:=-1;
flag:=sqrt2;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1811(52,85))*/
(WEST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1694(45,90))*/
task {/*#E*/ 
IncX:=-1;
IncY:=0;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1787(107,85))*/
(NORTH_EAST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1706(105,90))*/
task {/*#E*/ 
IncX:=1;
IncY:=1;
flag:=sqrt2;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1799(67,105))*/
(SOUTH):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1700(60,110))*/
task {/*#E*/ 
IncX:=0;
IncY:=-1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2009(92,105))*/
(SOUTH_EAST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1688(90,110))*/
task {/*#E*/ 
IncX:=1;
IncY:=-1;
flag:=sqrt2;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1745(75,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1739(75,135))*/
task {/*#E*/ 
 
NextPoint := ShipsCurrState(shipIndex)!Coordinates;
blockDist := 1;
maxDeep := d2i(ShipsCharacter(MyShipType)!MaxDeep);
tactCount := 3;
maxCheckDist := fix(float(tactCount * ShipsCurrState(shipIndex)!Speed)/flag);
if (maxCheckDist > 0 and maxCheckDist < 10) {
maxCheckDist := 10;
}

};
grst122:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2012(75,150))*/
decision /*#E*/ 
 blockDist<=maxCheckDist;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2297(70,147))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2291(15,160))*/
task {/*#E*/ 
Result!CollisionType := NO_COLLISION;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2288(30,175))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2048(87,162))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2171(65,170))*/
task {/*#E*/ 
NextPoint!x := NextPoint!x + IncX;
NextPoint!y := NextPoint!y + IncY;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2042(75,185))*/
decision /*#E*/ 
 
(NextPoint!x < 0) OR 
(NextPoint!y < 0) OR
(NextPoint!x > MaxXCoordinate) OR 
(NextPoint!y > MaxYCoordinate)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2129(57,192))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2126(55,195))*/
join /*#E*/ 
CollisionMapBorder;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2165(90,195))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1733(75,205))*/
task {/*#E*/ 
 
Deep := call getDeepXY(NextPoint!x,NextPoint!y);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1727(75,220))*/
decision /*#E*/ 
Deep < maxDeep;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2150(57,227))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2147(55,230))*/
join /*#E*/ 
CollisionWall;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1772(87,230))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1718(75,235))*/
task {/*#E*/ 
blockDist := blockDist + 1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),1727(75,220))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2042(75,185))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2012(75,150))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(1),2012(75,150))*/
join /*#E*/ 
grst122;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),509(75,5))*/
connection /*#E*/ 
CollisionShips 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),2066(95,35))*/
/* Итерация по вражеским кораблям */
:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1961(70,20))*/
decision /*#E*/ 
NumVisibleShips = 0;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1967(82,30))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),539(70,35))*/
task {/*#E*/ 
i := 1;};
grst123:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),533(70,50))*/
task {/*#E*/ 
 
NextPoint := call NextPosition2(EnemyShips(i)!Coordinates,
EnemyShips(i)!Heading, EnemyShips(i)!Speed, 
EnemyShips(i)!TypeShip);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),530(70,65))*/
decision /*#E*/ 
NextPoint = MyShipNextState!Coordinates;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),2093(107,72))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),2090(95,75))*/
task {/*#E*/ 
 
Result!CollisionPoint := NextPoint;
Result!CollisionType := ENEMY_SHIP_COLLISION;
Result!WallLayout := WALL_POINT;
Result!Distance := blockDist;
call DebugLogStringIntInt('Collision with enemy ship at', 
Result!CollisionPoint!x, Result!CollisionPoint!y);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),524(100,100))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),557(82,77))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),521(70,85))*/
task {/*#E*/ 
i := i+1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),518(70,100))*/
decision /*#E*/ 
 i <= NumVisibleShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),563(65,100))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),533(70,50))*/
join /*#E*/ 
grst123;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1958(82,110))*/
(false):
grst124:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1919(70,115))*/
task {/*#E*/ 
i := 1;};
grst125:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1916(70,130))*/
decision /*#E*/ 
shipIndex = i;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1925(82,140))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1913(55,145))*/
task {/*#E*/ 
OtherShipNextState := call NextShipState2(i);};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1907(70,160))*/
decision /*#E*/ 
OtherShipNextState!Coordinates = 
MyShipNextState!Coordinates;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),2102(107,167))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),2099(95,175))*/
task {/*#E*/ 
 
Result!CollisionPoint := OtherShipNextState!Coordinates;
Result!CollisionType := MY_SHIP_COLLISION;
Result!WallLayout := WALL_POINT;
Result!Distance := blockDist;
call DebugLogStringIntInt('Collision with friend ship at', 
Result!CollisionPoint!x, Result!CollisionPoint!y);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1901(100,190))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1943(82,172))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1907(70,160))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1928(65,135))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1916(70,130))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1898(70,185))*/
task {/*#E*/ 
i := i+1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1895(70,215))*/
decision /*#E*/ 
 i <= NumMyShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1949(20,130))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1955(92,220))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),2108(60,230))*/
task {/*#E*/ 
Result!CollisionType := NO_COLLISION;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1889(75,245))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1895(70,215))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1916(70,130))*/
join /*#E*/ 
grst125;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),518(70,100))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),530(70,65))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1976(62,20))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1919(70,115))*/
join /*#E*/ 
grst124;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),1961(70,20))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(2),509(75,5))*/
endconnection CollisionShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(3),2132(55,5))*/
connection /*#E*/ 
CollisionMapBorder:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(3),2135(35,25))*/
task {/*#E*/ 
Result!CollisionPoint := NextPoint;
Result!CollisionType := LAND_COLLISION;
Result!Distance := blockDist;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(3),2153(10,65))*/
task {/*#E*/ 
 
if ((NextPoint!x < 0 and NextPoint!y < 0) or (NextPoint!x > MaxXCoordinate and NextPoint!y < 0)
or (NextPoint!x < 0 and NextPoint!y > MaxYCoordinate) or (NextPoint!x > MaxXCoordinate and NextPoint!y > MaxYCoordinate))
{
Result!WallLayout := WALL_INNER_CORNER;
/*call DebugLogStringIntInt('Collision with map corner at', 
Result!CollisionPoint!x, Result!CollisionPoint!y);*/
}
else if (NextPoint!x < 0 or NextPoint!x > MaxXCoordinate) {
Result!WallLayout := WALL_VERTICAL;
/*call DebugLogStringIntInt('Collision with vertical map border at', 
Result!CollisionPoint!x, Result!CollisionPoint!y);*/
}
else if (NextPoint!y < 0 or NextPoint!y > MaxYCoordinate) {
Result!WallLayout := WALL_HORISONTAL;
/*call DebugLogStringIntInt('Collision with horisontal map border at', 
Result!CollisionPoint!x, Result!CollisionPoint!y);*/
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(3),2138(15,95))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(3),2132(55,5))*/
endconnection CollisionMapBorder;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2189(50,5))*/
connection /*#E*/ 
CollisionWall:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2198(30,25))*/
task {/*#E*/ 
Result!CollisionPoint := NextPoint;
Result!CollisionType := LAND_COLLISION;
Result!Distance := blockDist;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2207(45,55))*/
task {/*#E*/ 
 
/* This works with out-of-map bounds too */
CollisionLeft := (call getDeepXY(NextPoint!x-1,NextPoint!y)) < maxDeep;
CollisionRight := (call getDeepXY(NextPoint!x+1,NextPoint!y)) < maxDeep;
CollisionUp := (call getDeepXY(NextPoint!x,NextPoint!y+1)) < maxDeep;
CollisionDown := (call getDeepXY(NextPoint!x,NextPoint!y-1)) < maxDeep;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2237(45,75))*/
decision /*#E*/ 
CollisionLeft or CollisionRight
or CollisionUp or CollisionDown;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2249(27,90))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2246(20,95))*/
task {/*#E*/ 
Result!WallLayout := WALL_POINT;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2243(82,90))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2222(70,95))*/
task {/*#E*/ 
 
if (NextHead = NORTH or NextHead = SOUTH) {
    Result!WallLayout := WALL_HORISONTAL;
} 
else if (NextHead = EAST or NextHead = WEST) {
    Result!WallLayout := WALL_VERTICAL;
}
else if (NextHead = NORTH_EAST) {
    if (CollisionLeft and not CollisionDown) {
        Result!WallLayout := WALL_HORISONTAL;
    }
    else if (not CollisionLeft and CollisionDown) {
        Result!WallLayout := WALL_VERTICAL;
    }
    else if (CollisionLeft and CollisionDown) {
        Result!WallLayout := WALL_INNER_CORNER;
    }
    else if (CollisionUp or CollisionRight)
    {
        Result!WallLayout := WALL_OUTER_CORNER;
    }
}
else if (NextHead = NORTH_WEST) {
    if (CollisionRight and not CollisionDown) {
        Result!WallLayout := WALL_HORISONTAL;
    }
    else if (not CollisionRight and CollisionDown) {
        Result!WallLayout := WALL_VERTICAL;
    }
    else if (CollisionRight and CollisionDown) {
        Result!WallLayout := WALL_INNER_CORNER;
    }
    else if (CollisionUp or CollisionLeft)
    {
        Result!WallLayout := WALL_OUTER_CORNER;
    }
}
else if (NextHead = SOUTH_EAST) {
    if (CollisionLeft and not CollisionUp) {
        Result!WallLayout := WALL_HORISONTAL;
    }
    else if (not CollisionLeft and CollisionUp) {
        Result!WallLayout := WALL_VERTICAL;
    }
    else if (CollisionLeft and CollisionUp) {
        Result!WallLayout := WALL_INNER_CORNER;
    }
    else if (CollisionDown or CollisionRight)
    {
        Result!WallLayout := WALL_OUTER_CORNER;
    }
}
else if (NextHead = SOUTH_WEST) {
    if (CollisionRight and not CollisionUp) {
        Result!WallLayout := WALL_HORISONTAL;
    }
    else if (not CollisionRight and CollisionUp) {
        Result!WallLayout := WALL_VERTICAL;
    }
    else if (CollisionRight and CollisionUp) {
        Result!WallLayout := WALL_INNER_CORNER;
    }
    else if (CollisionDown or CollisionLeft)
    {
        Result!WallLayout := WALL_OUTER_CORNER;
    }
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2237(45,75))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2270(5,145))*/
task /*#E*/ 
'' 
/*
decision (Result!WallLayout) {
(WALL_HORISONTAL) : call DebugLogStringIntInt('Collision with horisontal wall at',
Result!CollisionPoint!x, Result!CollisionPoint!y);
(WALL_VERTICAL) : call DebugLogStringIntInt('Collision with vertical wall at',
Result!CollisionPoint!x, Result!CollisionPoint!y);
(WALL_INNER_CORNER) : call DebugLogStringIntInt('Collision with inner corner wall at',
Result!CollisionPoint!x, Result!CollisionPoint!y);
(WALL_OUTER_CORNER) : call DebugLogStringIntInt('Collision with outer corner wall at',
Result!CollisionPoint!x, Result!CollisionPoint!y);
(WALL_POINT) : call DebugLogStringIntInt('Collision with point wall at',
Result!CollisionPoint!x, Result!CollisionPoint!y);
}
*/
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2192(10,190))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd(4),2189(50,5))*/
endconnection CollisionWall;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\isCollision.spd,4)*/
endprocedure CheckCollision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd,4)*/
procedure NewHeadingChange2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd,1)*/
; fpar
    in OurShCurrState tShipCurrentState,
    TargetPoint tCoordinates;
 returns ReturnDirect tTurnDirection;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd(1),332(10,35))*/
newtype tCos
   Array(Integer, Real);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd(1),326(10,55))*/
 dcl
   NextHding tHeading,
   RightPoint, LeftPoint,  StraightPoint tCoordinates,
   i, indx  Integer,
   min Real,
   Cos tCos,
   CurrSpeed tSCMaxSpeed;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd(1),329(100,35))*/
procedure CosBetweenVectors2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd(1),335(150,35))*/
/* Вычисление косинуса
угла между 2 векторами */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd(2),116(10,85))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd(2),131(10,105))*/
task {/*#E*/ 
 
CurrSpeed := OurShCurrState!Speed;
if (CurrSpeed = 0) CurrSpeed :=  CurrSpeed+2;
NextHding := call NextDirection2(OurShCurrState!Heading, RIGHT);
RightPoint := call NextPosition2(OurShCurrState!Coordinates, NextHding, CurrSpeed, OurShCurrState!TypeShip);
NextHding := call NextDirection2(OurShCurrState!Heading, LEFT);
LeftPoint := call NextPosition2(OurShCurrState!Coordinates, NextHding, CurrSpeed, OurShCurrState!TypeShip);
StraightPoint :=call NextPosition2(OurShCurrState!Coordinates, OurShCurrState!Heading, CurrSpeed, OurShCurrState!TypeShip);
Cos(1) := call CosBetweenVectors2(OurShCurrState!Coordinates, RightPoint, TargetPoint);
Cos(2) := call CosBetweenVectors2(OurShCurrState!Coordinates, LeftPoint, TargetPoint);
Cos(3) := call CosBetweenVectors2(OurShCurrState!Coordinates, StraightPoint, TargetPoint);
min := Cos(1);
indx := 1;
for( i :=2, i<=3, i+1){
  if (Cos(i) > min) {
     min := Cos(i);
     indx := i;
  }
} 
if (indx = 1) ReturnDirect:=RIGHT;
else {
if (indx = 2) ReturnDirect:=LEFT;
 else ReturnDirect:=STRAIGHT;
}

};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd(2),119(15,125))*/
return /*#E*/ 
ReturnDirect;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NewHeading.spd,4)*/
endprocedure NewHeadingChange2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd,4)*/
procedure CosBetweenVectors2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd,1)*/
; fpar
  in StartPoint, EndPoint1, EndPoint2 tCoordinates; 
returns Cos Real;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),116(40,30))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),185(40,45))*/
decision /*#E*/ 
 
(StartPoint = EndPoint1) OR (StartPoint = EndPoint2)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),203(37,45))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),200(5,55))*/
task {/*#E*/ 
Cos := -2;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),296(10,70))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),215(52,55))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),212(40,60))*/
decision /*#E*/ 
 
( (EndPoint1!x - StartPoint!x = 0) AND (EndPoint2!x - StartPoint!x =0) AND 
   ((EndPoint1!y - StartPoint!y)*(EndPoint2!y - StartPoint!y) > 0) )
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),263(52,70))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),260(40,75))*/
decision /*#E*/ 
 
( (EndPoint1!y - StartPoint!y = 0) AND (EndPoint2!y - StartPoint!y =0) AND 
   ((EndPoint1!x - StartPoint!x)*(EndPoint2!x - StartPoint!x) > 0) )
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),278(52,87))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),275(40,90))*/
decision /*#E*/ 
 
( (EndPoint1!y - StartPoint!y /= 0) AND (EndPoint2!y - StartPoint!y /=0)) AND
( (EndPoint1!x - StartPoint!x /= 0) AND (EndPoint2!x - StartPoint!x /=0)) AND
 ( float(EndPoint1!x - StartPoint!x)/float(EndPoint2!x - StartPoint!x) = 
   float(EndPoint1!y - StartPoint!y)/float(EndPoint2!y - StartPoint!y) )AND
 ( ((EndPoint1!x - StartPoint!x)*(EndPoint2!x - StartPoint!x) > 0) AND
    ((EndPoint1!y - StartPoint!y)*(EndPoint2!y - StartPoint!y) > 0) )
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),290(32,97))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),293(67,97))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),146(55,115))*/
task {/*#E*/ 
 
Cos := float((EndPoint1!x - StartPoint!x)*(EndPoint2!x - StartPoint!x) 
                   + (EndPoint1!y - StartPoint!y)*(EndPoint2!y - StartPoint!y))/
float((call getDistance(StartPoint!x, StartPoint!y, EndPoint1!x, EndPoint1!y))*
         (call getDistance(StartPoint!x, StartPoint!y, EndPoint2!x, EndPoint2!y)));
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),245(60,130))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),275(40,90))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),272(32,82))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),260(40,75))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),233(32,67))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),212(40,60))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),227(25,115))*/
task {/*#E*/ 
Cos := 2;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),119(30,130))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd(1),185(40,45))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CosBetweenVectors.spd,4)*/
endprocedure CosBetweenVectors2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd,4)*/
procedure NextDirection2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd,1)*/
; fpar
  CurrHding tHeading,
  Dir tHeadingChange;
  returns NewHeading tHeading;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),152(135,15))*/
dcl
   Numbr Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),149(70,20))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),353(70,40))*/
task {/*#E*/ 
 
Numbr := h2i(CurrHding);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),209(70,60))*/
decision /*#E*/ 
Dir;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),245(55,67))*/
(RIGHT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),239(55,75))*/
task {/*#E*/ 
 
Numbr := Numbr +1;
if (Numbr > 7) Numbr := 0;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),242(97,67))*/
(LEFT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),236(85,75))*/
task {/*#E*/ 
 
Numbr := Numbr -1;
if (Numbr < 0) Numbr:= 7;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),209(70,60))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),368(70,95))*/
task {/*#E*/ 
 
NewHeading := i2h(Numbr);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd(1),311(75,115))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextDirection.spd,4)*/
endprocedure NextDirection2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd,4)*/
procedure NextPosition2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd,1)*/
; fpar
  CurrPos tCoordinates,
  Direct tHeading,
  Speed tSCMaxSpeed,
  NameShip tNameShip;
  returns NextPos tCoordinates;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),212(130,10))*/
dcl
  IncX, IncY, Deep, maxDeep Integer,
  flag Real := 1,
  i Integer,
  onLand Boolean;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),578(70,15))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),494(70,35))*/
decision /*#E*/ 
Direct;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),497(22,40))*/
(NORTH):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),491(10,45))*/
task {/*#E*/ 
IncX:=0;
IncY:=1;};
grst126:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),467(70,135))*/
task {/*#E*/ 
 
onLand := false;
NextPos := CurrPos;
maxDeep := d2i(ShipsCharacter(NameShip)!MaxDeep);
Deep := call getDeepXY(NextPos!x,NextPos!y);
if (Deep < maxDeep) onLand := true;
};
grst127:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),626(70,160))*/
decision /*#E*/ 
 
 i<=fix(float(Speed)/flag)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),635(82,170))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),455(70,175))*/
decision /*#E*/ 
 
(NextPos!x + IncX < 0) OR 
(NextPos!y + IncY < 0) OR
(NextPos!x + IncX > MaxXCoordinate) OR 
(NextPos!y + IncY > MaxYCoordinate) OR
( (Deep < maxDeep) AND (onLand = false) )
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),692(65,175))*/
(true):
grst128:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),449(45,185))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),617(82,187))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),611(70,195))*/
task {/*#E*/ 
 
NextPos!x := NextPos!x + IncX;
NextPos!y := NextPos!y + IncY;
Deep := call getDeepXY(NextPos!x,NextPos!y);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),446(70,210))*/
task {/*#E*/ 
i := i+1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),626(70,160))*/
join /*#E*/ 
grst127;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),455(70,175))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),695(65,160))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),449(45,185))*/
join /*#E*/ 
grst128;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),626(70,160))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),515(147,40))*/
(NORTH_WEST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),473(135,45))*/
task {/*#E*/ 
IncX:=-1;
IncY:=1;};
grst129:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),698(85,115))*/
task {/*#E*/ 
flag:=sqrt2;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),467(70,135))*/
join /*#E*/ 
grst126;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),503(37,52))*/
(EAST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),485(25,60))*/
task {/*#E*/ 
IncX:=1;
IncY:=0;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),467(70,135))*/
join /*#E*/ 
grst126;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),509(137,60))*/
(SOUTH_WEST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),479(115,60))*/
task {/*#E*/ 
IncX:=-1;
IncY:=-1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),698(85,115))*/
join /*#E*/ 
grst129;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),512(52,67))*/
(WEST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),476(40,75))*/
task {/*#E*/ 
IncX:=-1;
IncY:=0;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),467(70,135))*/
join /*#E*/ 
grst126;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),500(122,75))*/
(NORTH_EAST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),488(100,75))*/
task {/*#E*/ 
IncX:=1;
IncY:=1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),698(85,115))*/
join /*#E*/ 
grst129;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),506(67,82))*/
(SOUTH):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),482(55,90))*/
task {/*#E*/ 
IncX:=0;
IncY:=-1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),467(70,135))*/
join /*#E*/ 
grst126;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),644(107,90))*/
(SOUTH_EAST):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),470(85,90))*/
task {/*#E*/ 
IncX:=1;
IncY:=-1;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),698(85,115))*/
join /*#E*/ 
grst129;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd(1),494(70,35))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextPosition.spd,4)*/
endprocedure NextPosition2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd,4)*/
procedure NextShipState2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd,1)*/
;fpar
   in index Integer;
returns ShipNextState tShipCurrentState;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),197(135,10))*/
dcl
   OldSpeed tSCMaxSpeed,
   OldHeading tHeading,
   OldCoords tCoordinates,
   TypeShp tNameShip,
   TempSpeed Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),119(40,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),200(40,40))*/
task {/*#E*/ 
 
OldSpeed := ShipsCurrState(index)!Speed;
OldHeading := ShipsCurrState(index)!Heading;
OldCoords := ShipsCurrState(index)!Coordinates;
TypeShp := ShipsCurrState(index)!TypeShip;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),155(40,60))*/
decision /*#E*/ 
 
CommandToShip(index)!isSet
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),161(52,72))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),149(40,80))*/
decision /*#E*/ 
 
CommandToShip(index)!OrderType
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),167(65,90))*/
(_ACCEL):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),143(55,95))*/
task {/*#E*/ 
 
TempSpeed := OldSpeed +
fix(float(ShipsCharacter(TypeShp)!MaxAcceleration)*CommandToShip(index)!Accel);
if (TempSpeed < 0)  ShipNextState!Speed := 0;
if (TempSpeed > (ShipsCharacter(TypeShp)!MaxSpeed)) {
    ShipNextState!Speed := ShipsCharacter(TypeShp)!MaxSpeed;
}
ShipNextState!Heading := OldHeading;
ShipNextState!Coordinates := call NextPosition2(OldCoords, OldHeading,
                                                        ShipNextState!Speed, ShipNextState!TypeShip);
};
grst130:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),215(60,205))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),173(52,130))*/
(_RIGHT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),137(40,135))*/
task {/*#E*/ 
 
ShipNextState!Speed := OldSpeed;
ShipNextState!Heading := call NextDirection2(OldHeading, RIGHT);
ShipNextState!Coordinates := call NextPosition2(OldCoords, ShipNextState!Heading, OldSpeed, 
ShipNextState!TypeShip);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),215(60,205))*/
join /*#E*/ 
grst130;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),179(37,155))*/
(_LEFT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),131(25,160))*/
task {/*#E*/ 
 
ShipNextState!Speed := OldSpeed;
ShipNextState!Heading := call NextDirection2(
OldHeading, LEFT);
ShipNextState!Coordinates := call NextPosition2(
OldCoords,ShipNextState!Heading, OldSpeed, 
ShipNextState!TypeShip);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),215(60,205))*/
join /*#E*/ 
grst130;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),185(22,180))*/
else:
grst131:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),125(10,185))*/
task {/*#E*/ 
 
ShipNextState!Speed := OldSpeed;
ShipNextState!Heading := OldHeading;
ShipNextState!Coordinates := call NextPosition2(
OldCoords,OldHeading, OldSpeed, ShipNextState!TypeShip);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),215(60,205))*/
join /*#E*/ 
grst130;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),149(40,80))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),191(35,60))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),125(10,185))*/
join /*#E*/ 
grst131;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd(1),155(40,60))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\NextShipState.spd,4)*/
endprocedure NextShipState2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd,4)*/
procedure EnemyNotFound2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd,1)*/
; fpar
  in/out ShCurrSt tShipCurrentState;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),902(5,25))*/
dcl
   ChangeDirection tTurnDirection,
   ShipType tNameShip,
   NextHeading tTurnDirection,
   TargetHeading tHeading,
   ShipId tShipId;

/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(2),1301(85,5))*/
dcl PrevCoords tCoordinates;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1202(5,55))*/
procedure ComputeTargetDir referenced;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),116(60,5))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1010(60,25))*/
task {/*#E*/ 
 
ChangeDirection := STRAIGHT;
ShipType:=ShCurrSt!TypeShip;
ShipId := ShCurrSt!ShipId;
call DebugLogStringInt('ship id', ShipId);
CommandToShip(shipIndex)!isSet := false;
CommandToShip(shipIndex)!Accel := 0;

/* Init free motion - rotate to appropriate angle */
if (not (call GetShipReadyToFreeMotion(ShipId))) {
    if (ShCurrSt!Speed > 0) {
        CommandToShip(shipIndex)!isSet := true;
        CommandToShip(shipIndex)!Accel := -1;
    }
    else {
        call SetShipTargetHeading(ShipId, call ComputeTargetDir(ShCurrSt!Coordinates));
        if ((call GetShipTargetHeading(ShipId)) = ShCurrSt!Heading) {
            call SetShipReadyToFreeMotion(ShipId, true);
            call SetShipPrevCoords(ShipId, ShCurrSt!Coordinates);
        }
    }
}
else if (ShCurrSt!Speed = 0) {
    CommandToShip(shipIndex)!isSet := true;
    CommandToShip(shipIndex)!Accel := 1;
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1214(65,65))*/
join /*#E*/ 
CrossedCenter;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1220(65,80))*/
connection /*#E*/ 
CrossedCenter_End:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1271(60,95))*/
task {/*#E*/ 
 
if ((call GetShipTargetHeading(ShipId)) /= ShCurrSt!Heading) {
    ChangeDirection := call GetTurnDirection(ShCurrSt!Heading, (call GetShipTargetHeading(ShipId)));
    CommandToShip(shipIndex)!isSet := true;
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1022(60,120))*/
decision /*#E*/ 
ChangeDirection;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1031(22,127))*/
(RIGHT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1028(5,140))*/
task {/*#E*/ 
CommandToShip(shipIndex)!OrderType := _RIGHT;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1037(122,127))*/
(LEFT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1034(95,140))*/
task {/*#E*/ 
CommandToShip(shipIndex)!OrderType :=_LEFT;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1040(72,132))*/
else:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),950(60,140))*/
task {/*#E*/ 
CommandToShip(shipIndex)!OrderType := _ACCEL;};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1022(60,120))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1283(60,160))*/
task {/*#E*/ 
 
call SetShipPrevCoords(ShipId, ShCurrSt!Coordinates);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),878(65,180))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(1),1220(65,80))*/
endconnection CrossedCenter_End;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(2),1235(55,10))*/
connection /*#E*/ 
CrossedCenter:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(2),1244(50,25))*/
task {/*#E*/ 
 
PrevCoords := call GetShipPrevCoords(ShipId);
if ((PrevCoords!x < MapCenterX and ShCurrSt!Coordinates!x >= MapCenterX)
or (PrevCoords!x > MapCenterX and ShCurrSt!Coordinates!x <= MapCenterX)) {
if (ShCurrSt!Heading = SOUTH_EAST) {
    ChangeDirection := LEFT;
    call SetShipTargetHeading(ShipId, NORTH_EAST);
}
else if (ShCurrSt!Heading = NORTH_WEST) {
    ChangeDirection := LEFT;
    call SetShipTargetHeading(ShipId, SOUTH_WEST);
}
else if (ShCurrSt!Heading = NORTH_EAST) {
    ChangeDirection := RIGHT;
    call SetShipTargetHeading(ShipId, SOUTH_EAST);
}
else if (ShCurrSt!Heading = SOUTH_WEST) {
    ChangeDirection := RIGHT;
    call SetShipTargetHeading(ShipId, NORTH_WEST);
}
}

if ((PrevCoords!y < MapCenterY and ShCurrSt!Coordinates!y >= MapCenterY)
or (PrevCoords!y > MapCenterY and ShCurrSt!Coordinates!y <= MapCenterY)) {
if (ShCurrSt!Heading = SOUTH_EAST) {
    ChangeDirection := RIGHT;
    call SetShipTargetHeading(ShipId, SOUTH_WEST);
}
else if (ShCurrSt!Heading = NORTH_WEST) {
    ChangeDirection := RIGHT;
    call SetShipTargetHeading(ShipId, NORTH_EAST);
}
else if (ShCurrSt!Heading = NORTH_EAST) {
    ChangeDirection := LEFT;
    call SetShipTargetHeading(ShipId, NORTH_WEST);
}
else if (ShCurrSt!Heading = SOUTH_WEST) {
    ChangeDirection := LEFT;
    call SetShipTargetHeading(ShipId, SOUTH_EAST);
}
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(2),1238(55,40))*/
join /*#E*/ 
CrossedCenter_End;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd(2),1235(55,10))*/
endconnection CrossedCenter;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyNotFound.spd,4)*/
endprocedure EnemyNotFound2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ComputeTargetDir,4)*/
procedure ComputeTargetDir
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ComputeTargetDir,1)*/
;fpar ShipCoords tCoordinates;
returns TargetDir tHeading;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ComputeTargetDir(1),116(60,5))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ComputeTargetDir(1),119(60,20))*/
task {/*#E*/ 
 
if (ShipCoords!x < MapCenterX and ShipCoords!y < MapCenterY)
{
TargetDir := NORTH_EAST;
}
else if (ShipCoords!x >= MapCenterX and ShipCoords!y < MapCenterY)
{
TargetDir := NORTH_WEST;
}
else if (ShipCoords!x < MapCenterX and ShipCoords!y >= MapCenterY)
{
TargetDir := SOUTH_EAST;
}
else
{
TargetDir := SOUTH_WEST;
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ComputeTargetDir(1),125(65,40))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ComputeTargetDir,4)*/
endprocedure ComputeTargetDir;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd,4)*/
procedure EnemyFound2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd,1)*/
; fpar
  in/out ShCurrSt tShipCurrentState,
  in k Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),449(10,30))*/
newtype tShootWeaponry
struct
   TypeWeaponry tNameWeaponry;
   isWeaponry Boolean;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),452(10,55))*/
newtype tShootList
struct
   SortParam Real;
   Number Integer;
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),455(10,80))*/
newtype tStringShootList
  String(tShootList,empty);
endnewtype;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),170(10,95))*/
dcl
   MaxPointsToShoot, NumPointsToShoot,i,j Integer,
   DistBetweenShips Integer,
   NextHeading tTurnDirection,
   CanShootWeaponry tShootWeaponry,
   BestWeaponry tNameWeaponry,
   ShootPoint, Temp tShootList,
   ShootList tStringShootList,
   PointToOrder tCoordinates,
   DestroyFlag Boolean := false;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),173(85,30))*/
procedure ActivateREPAIR2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),458(145,30))*/
/* Реализация поведения
ремонтника */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),206(85,45))*/
procedure CanShootEnemyCenter2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),464(145,45))*/
/* Проверка на возможность
дострельнуть до центра
масс вражеских кораблей */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),578(85,60))*/
procedure SortShootList2 referenced 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(1),581(145,60))*/
/* Сортирует список точек
выстреловShootList
по возрастанию SortParam */
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),116(85,15))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),146(85,35))*/
decision /*#E*/ 
ShCurrSt!TypeShip;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),725(47,42))*/
(REPAIR_BOAT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),665(35,55))*/
task {/*#E*/ 
 
for (i:=1,i<=NumMyShips,i+1) {
     if (ShipsCurrState(i)!_
         Resource < 
         ShipsCharacter
         (ShipsCurrState(i)!_
         TypeShip)!_
         MaxResource) {
         DestroyFlag := true;
         break; 
     }
}

};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),626(35,100))*/
decision /*#E*/ 
 
(ShCurrSt!_
Ammunition
(REPAIR) /= 0) AND
(DestroyFlag = true) AND
(NumMyShips > 1)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),875(17,107))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),182(10,110))*/
call /*#E*/ 
ActivateREPAIR2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),653(15,125))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),872(67,150))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),827(55,150))*/
decision /*#E*/ 
NumMyShips = NumRepairShips;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),869(47,157))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),692(40,170))*/
task /*#E*/ 
 
NextHeading := call
NewHeadingChange2( 
ShCurrSt,MyCenter)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),866(82,157))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),851(70,170))*/
task /*#E*/ 
 
NextHeading := call
NewHeadingChange2(ShCurrSt,
EnemyCenter)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),827(55,150))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),845(60,190))*/
join /*#E*/ 
F2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),626(35,100))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1154(137,42))*/
else:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1133(110,50))*/
task /*#E*/ 
CanShootWeaponry := call CanShootEnemyCenter2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1127(135,70))*/
decision /*#E*/ 
CanShootWeaponry!isWeaponry;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1160(117,77))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1157(115,80))*/
join /*#E*/ 
F1;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1145(147,82))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1121(115,95))*/
task /*#E*/ 
NextHeading := call NewHeadingChange2(ShCurrSt, EnemyCenter);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1115(140,110))*/
join /*#E*/ 
F2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),1127(135,70))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(2),146(85,35))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),815(85,5))*/
connection /*#E*/ 
F2:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),773(80,45))*/
decision /*#E*/ 
 
NextHeading
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),779(95,57))*/
(LEFT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),767(80,65))*/
task {/*#E*/ 
 
CommandToShip(k)!_
OrderType := _LEFT;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),788(72,57))*/
(RIGHT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),758(60,80))*/
task {/*#E*/ 
 
CommandToShip(k)!_
OrderType := _RIGHT;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),797(62,57))*/
else:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),752(45,105))*/
decision /*#E*/ 
 
ShCurrSt!Speed = 
ShipsCharacter_
(ShCurrSt!TypeShip)!_
MaxSpeed 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),803(65,105))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),746(65,125))*/
task {/*#E*/ 
 
CommandToShip(k)!_
OrderType := _ACCEL;
CommandToShip(k)!Accel := 1;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),812(47,117))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),752(45,105))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),740(50,140))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),773(80,45))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),761(85,95))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(3),815(85,5))*/
endconnection F2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),284(70,5))*/
connection /*#E*/ 
F1:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),389(65,20))*/
decision /*#E*/ 
 
ShCurrSt!Speed = 0
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),722(77,30))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),401(65,35))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _ACCEL;  
CommandToShip(k)!Accel := -1;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),416(70,50))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),575(57,25))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),521(15,65))*/
task {/*#E*/ 
 
BestWeaponry := CanShootWeaponry!TypeWeaponry;
if (ShipsCharacter(ShCurrSt!TypeShip)!MaxLaunchUnit(BestWeaponry) < ShCurrSt!Ammunition(BestWeaponry))
{
   MaxPointsToShoot :=  ShipsCharacter(ShCurrSt!TypeShip)!MaxLaunchUnit(BestWeaponry);
}
else 
    MaxPointsToShoot := ShCurrSt!Ammunition(BestWeaponry);
for (i:=1, i<=NumVisibleShips, i+1) {
     DistBetweenShips := call
     getDistance(ShCurrSt!Coordinates!x,ShCurrSt!Coordinates!y,
     EnemyShips(i)!Coordinates!x,EnemyShips(i)!Coordinates!y);
     if (WeaponryCharacter(BestWeaponry)!Range >= DistBetweenShips) {
         ShootPoint!SortParam := float(DistBetweenShips);
         ShootPoint!Number := i;
         ShootList := ShootList // mkstring(ShootPoint);
     }
}
call SortShootList2;
if (length(ShootList) > MaxPointsToShoot) NumPointsToShoot := MaxPointsToShoot;
else NumPointsToShoot := length(ShootList);
CommandToShip(k)!OrderType := _FIRE;
CommandToShip(k)!Fire!Weapon := BestWeaponry;
for (i:=1, i<=NumPointsToShoot, i+1) {
  PointToOrder := call NextPosition2(EnemyShips(ShootList(i)!Number)!Coordinates, 
                                                               EnemyShips(ShootList(i)!Number)!Heading, 
                                                               EnemyShips(ShootList(i)!Number)!Speed, 
                                                               EnemyShips(ShootList(i)!Number)!TypeShip);
  CommandToShip(k)!Fire!List := CommandToShip(k)!Fire!List // mkstring(PointToOrder);
}
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),281(20,85))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),389(65,20))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd(4),284(70,5))*/
endconnection F1;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\EnemyFound.spd,4)*/
endprocedure EnemyFound2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd,4)*/
procedure ActivateREPAIR2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1232(135,10))*/
dcl
   NextShipSt tShipCurrentState;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),116(25,10))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),125(25,25))*/
task {/*#E*/ 
 
for (i:=1, i<=NumMyShips, i+1) {
     DistBetweenShips :=  call
     getDistance(ShCurrSt!Coordinates!x,ShCurrSt!Coordinates!y,
     ShipsCurrState(i)!Coordinates!x,ShipsCurrState(i)!Coordinates!y);
     if ((WeaponryCharacter(REPAIR)!Range >= DistBetweenShips) AND
         (ShipsCurrState(i)!Resource < 
          ShipsCharacter(ShipsCurrState(i)!TypeShip)!MaxResource)) {
          ShootPoint!SortParam := 
          float(ShipsCurrState(i)!Resource)/float(ShipsCharacter(ShipsCurrState(i)!TypeShip)!_
          MaxResource);
          ShootPoint!Number := i;
          ShootList := ShootList // mkstring(ShootPoint);
     }
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),137(25,80))*/
decision /*#E*/ 
 
length(ShootList) = 0
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1265(37,90))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1247(25,95))*/
decision /*#E*/ 
 
ShCurrSt!Speed = 0
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1253(52,105))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1241(40,110))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _ACCEL;  
CommandToShip(k)!Accel := -1;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1271(45,125))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1268(27,105))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1049(25,140))*/
call /*#E*/ 
 
SortShootList2
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1067(25,155))*/
task {/*#E*/ 
 
if (ShipsCharacter(REPAIR_BOAT)!MaxLaunchUnit(REPAIR) < 
    ShCurrSt!Ammunition(REPAIR))
    MaxPointsToShoot :=  ShipsCharacter(REPAIR_BOAT)!_
                                            MaxLaunchUnit(REPAIR);
else 
    MaxPointsToShoot := ShCurrSt!Ammunition(REPAIR);
if (length(ShootList) > MaxPointsToShoot) NumPointsToShoot := MaxPointsToShoot;
else NumPointsToShoot := length(ShootList);
CommandToShip(k)!OrderType := _FIRE;
CommandToShip(k)!Fire!Weapon := REPAIR;
for (i:=1, i<=NumPointsToShoot, i+1) {
  NextShipSt := call NextShipState2(ShootList(i)!Number);
  PointToOrder := NextShipSt!Coordinates;
  CommandToShip(k)!Fire!List := CommandToShip(k)!Fire!List // mkstring(PointToOrder);
}
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1247(25,95))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1088(22,80))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1085(10,110))*/
join /*#E*/ 
R1;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),137(25,80))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),1091(10,185))*/
R2:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(1),119(30,200))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),188(55,10))*/
connection /*#E*/ 
R1:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1097(50,30))*/
task {/*#E*/ 
 
ShootList := empty;
for (i:=1, i<=NumMyShips, i+1) {
     DistBetweenShips := call
     getDistance(ShCurrSt!Coordinates!x,ShCurrSt!Coordinates!y,
     ShipsCurrState(i)!Coordinates!x,ShipsCurrState(i)!Coordinates!y);
     if (ShipsCurrState(i)!Resource < 
         ShipsCharacter(ShipsCurrState(i)!TypeShip)!MaxResource) {
         ShootPoint!SortParam := 
         float(ShipsCurrState(i)!Resource)/float(ShipsCharacter(
                  ShipsCurrState(i)!TypeShip)!MaxResource);
         ShootPoint!Number := i;
         ShootList := ShootList // mkstring(ShootPoint);
     }
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1214(50,85))*/
call /*#E*/ 
 
SortShootList2
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1151(50,100))*/
task {/*#E*/ 
 
NextHeading := call
NewHeadingChange2(ShCurrSt,
ShipsCurrState(ShootList(1)!Number)!Coordinates);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1145(50,115))*/
decision /*#E*/ 
 
NextHeading
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1163(65,127))*/
(LEFT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1139(50,135))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _LEFT;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1166(42,127))*/
(RIGHT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1133(30,150))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _RIGHT;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1169(32,127))*/
else:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1121(15,175))*/
decision /*#E*/ 
 
ShCurrSt!Speed = 
ShipsCharacter(REPAIR_BOAT)!MaxSpeed 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1187(40,175))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1118(45,190))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _ACCEL;
CommandToShip(k)!Accel := 1;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1205(27,187))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1121(15,175))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),191(20,205))*/
join /*#E*/ 
R2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1145(50,115))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),1127(55,165))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd(2),188(55,10))*/
endconnection R1;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\ActivateREPAIR.spd,4)*/
endprocedure ActivateREPAIR2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd,4)*/
procedure CanShootEnemyCenter2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd,1)*/
; 
returns Weapon  tShootWeaponry;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),209(150,5))*/
dcl
   Dist Integer; 
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),116(75,10))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),197(75,25))*/
task /*#E*/ 
 
Dist := call getDistance(ShCurrSt!Coordinates!x,
ShCurrSt!Coordinates!y, EnemyCenter!x,EnemyCenter!y)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),137(75,40))*/
decision /*#E*/ 
 
(ShCurrSt!Ammunition(MISSILE) /= 0) AND
(WeaponryCharacter(MISSILE)!Range >= Dist)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),218(72,40))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),215(50,50))*/
task {/*#E*/ 
 
Weapon!TypeWeaponry := 
   MISSILE;
Weapon!isWeaponry := 
   true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),149(55,65))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),158(87,52))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),155(75,75))*/
decision /*#E*/ 
 
ShCurrSt!Ammunition(TORPEDO) /= 0 AND
(WeaponryCharacter(TORPEDO)!Range >= Dist)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),245(72,75))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),233(50,85))*/
task {/*#E*/ 
 
Weapon!TypeWeaponry := 
  TORPEDO;
Weapon!isWeaponry := 
  true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),230(55,100))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),179(87,87))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),176(75,110))*/
decision /*#E*/ 
 
(ShCurrSt!Ammunition(SHELL) /= 0) AND
(WeaponryCharacter(SHELL)!Range >= Dist)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),296(72,110))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),281(50,120))*/
task {/*#E*/ 
 
Weapon!TypeWeaponry := 
  SHELL;
Weapon!isWeaponry := 
  true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),278(55,135))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),302(87,122))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),299(75,130))*/
task {/*#E*/ 
 
Weapon!isWeaponry :=  false;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),119(80,150))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),176(75,110))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),155(75,75))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd(1),137(75,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\CanShootEnemyCenter.spd,4)*/
endprocedure CanShootEnemyCenter2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SortShootList.spd,4)*/
procedure SortShootList2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SortShootList.spd(1),116(55,20))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SortShootList.spd(1),122(55,35))*/
task {/*#E*/ 
 
for (i:=1, i<=length(ShootList)-1, i+1) {
  for (j := length(ShootList), j>=i+1, j-1) {
     if (ShootList(j)!SortParam <  ShootList(j-1)!SortParam) {
             Temp := ShootList(j-1);
             ShootList(j-1) := ShootList(j);
             ShootList(j) := Temp;
     }
  }
  for (j := i+1, j<=length(ShootList)-1, j+1) {
     if (ShootList(j)!SortParam >  ShootList(j+1)!SortParam) {
             Temp := ShootList(j+1);
             ShootList(j+1) := ShootList(j);
             ShootList(j) := Temp;
     }          
  }
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SortShootList.spd(1),119(60,65))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SortShootList.spd,4)*/
endprocedure SortShootList2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd,4)*/
procedure OutputCommand;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),116(60,5))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),272(60,20))*/
decision /*#E*/ 
 
CommandToShip(shipIndex)!isSet
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),356(57,20))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),353(25,30))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),287(72,32))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),263(60,40))*/
decision /*#E*/ 
 
CommandToShip(shipIndex)!OrderType
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),293(92,52))*/
(_LEFT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),257(80,60))*/
output /*#E*/ 
 
OrderTurnRequest(
ShipsCurrState(shipIndex)!ShipId, StrategyID, LEFT)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),368(80,75))*/
call /*#E*/ 
DebugLogStringInt('Command: turn LEFT ship', shipIndex);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),329(85,90))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),302(72,97))*/
(_RIGHT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),248(60,105))*/
output /*#E*/ 
 
OrderTurnRequest(
ShipsCurrState(shipIndex)!ShipId, StrategyID, RIGHT)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),374(60,120))*/
call /*#E*/ 
DebugLogStringInt('Command: turn RIGHT ship', shipIndex);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),341(65,135))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),311(47,47))*/
(_ACCEL):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),239(40,150))*/
output /*#E*/ 
 
OrderSpeedRequest(ShipsCurrState(shipIndex)!ShipId, StrategyID,
CommandToShip(shipIndex)!Accel)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),386(40,165))*/
task {/*#E*/ 
 
if (CommandToShip(shipIndex)!Accel > 0) {
call DebugLogStringInt('Command: +accelerate ship', shipIndex);
} else {
call DebugLogStringInt('Command: -accelerate ship', shipIndex);
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),332(45,180))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),320(27,47))*/
(_FIRE):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),230(20,200))*/
output /*#E*/ 
 
OrderFireRequest(ShipsCurrState(shipIndex)!ShipId, StrategyID,
CommandToShip(shipIndex)!Fire!Weapon,CommandToShip(shipIndex)!Fire!List)
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),362(20,215))*/
call /*#E*/ 
DebugLogStringInt('Command: FIRE ship', shipIndex);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),338(25,230))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),263(60,40))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd(1),272(60,20))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OutputOrder.spd,4)*/
endprocedure OutputCommand;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd,4)*/
procedure OnLand2
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd,1)*/
;fpar
  in MyLandShip tShipCurrentState,
  in k Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),122(135,10))*/
dcl
   i,j Integer,
   PathCoord tCoordinates,
   Direct tTurnDirection,
   flagPath Boolean,
   factorAccel Real;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),116(40,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),125(40,40))*/
task {/*#E*/ 
 
call DebugLogString('Ship stucked in wall');
flagPath := false;
for (i:=MyLandShip!Coordinates!x-1, i <=MyLandShip!Coordinates!x+1, i+1) {
  for (j:=MyLandShip!Coordinates!y-1, j <=MyLandShip!Coordinates!y+1, j+1) {
   if ( (i > 0) AND (i < MaxXCoordinate) AND (j > 0) AND (j < MaxYCoordinate) ){
     if ( (call getDeepXY(i, j)) <= d2i(ShipsCharacter(MyLandShip!TypeShip)!MaxDeep)) {
       PathCoord!x := i;
       PathCoord!y := j;
       flagPath := true;
       break;
       }
    }
  }
  if (flagPath = true) break;
}
call DebugLogStringIntInt('Avoid Stuck: go to coordinates', i, j);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),209(40,80))*/
decision /*#E*/ 
flagPath;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),227(37,80))*/
(false):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),224(20,90))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),221(52,92))*/
(true):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),137(40,100))*/
task {/*#E*/ 
 
Direct := call NewHeadingChange2(MyLandShip, PathCoord);
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),149(40,115))*/
decision /*#E*/ 
Direct;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),167(57,125))*/
(LEFT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),155(55,130))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _LEFT;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),170(40,125))*/
(RIGHT):
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),158(40,145))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _RIGHT;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),176(25,125))*/
else:
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),164(25,160))*/
task {/*#E*/ 
 
CommandToShip(k)!OrderType := _ACCEL;
factorAccel := 2.5/
float(ShipsCharacter(MyLandShip!TypeShip)!MaxAcceleration);
if (factorAccel >= 1)  factorAccel := 1;
CommandToShip(k)!Accel := factorAccel;
CommandToShip(k)!isSet := true;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),149(40,115))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),119(45,175))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd(1),209(40,80))*/
enddecision;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\OnLand.spd,4)*/
endprocedure OnLand2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\FindHeadingTarget2.spd,4)*/
procedure FindHeadingTarget2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\FindHeadingTarget2.spd(1),116(55,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\FindHeadingTarget2.spd(1),137(55,50))*/
task {/*#E*/ 
 
HeadingTarget!x := ShipsCurrState(shipIndex)!Coordinates!x + 1;
HeadingTarget!y := ShipsCurrState(shipIndex)!Coordinates!y + 1;
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\FindHeadingTarget2.spd(1),119(60,85))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\FindHeadingTarget2.spd,4)*/
endprocedure FindHeadingTarget2;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetTurnDirection.spd,4)*/
procedure GetTurnDirection
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetTurnDirection.spd,1)*/
; fpar
  CurrHeading tHeading,
  TargetHeading tHeading;
  returns DirChange tTurnDirection;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetTurnDirection.spd(1),134(150,5))*/
dcl
CurrHeadingInt Integer,
TargetHeadingInt Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetTurnDirection.spd(1),116(60,5))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetTurnDirection.spd(1),125(60,20))*/
task {/*#E*/ 
 
CurrHeadingInt := h2i(CurrHeading);
TargetHeadingInt := h2i(TargetHeading);
/* Convert to basis: CurrHeading = 0 */
TargetHeadingInt := TargetHeadingInt - CurrHeadingInt;
if (TargetHeadingInt < 0)
{
    TargetHeadingInt := TargetHeadingInt + 8;
}
if (TargetHeadingInt > 4)
{
    DirChange := LEFT;
}
else
{
    DirChange := RIGHT;
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetTurnDirection.spd(1),119(65,80))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetTurnDirection.spd,4)*/
endprocedure GetTurnDirection;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringInt.spd,4)*/
procedure DebugLogStringInt
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringInt.spd,1)*/
; fpar
  str Charstring,
  val Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringInt.spd(1),119(65,10))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringInt.spd(1),134(65,35))*/
output /*#E*/ 
messageLog(call ConcatStringInt(str, val));
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringInt.spd(1),122(70,65))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringInt.spd,4)*/
endprocedure DebugLogStringInt;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogString.spd,4)*/
procedure DebugLogString
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogString.spd,1)*/
; fpar
  str Charstring;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogString.spd(1),122(55,15))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogString.spd(1),119(55,40))*/
output /*#E*/ 
messageLog(str);
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogString.spd(1),116(60,70))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogString.spd,4)*/
endprocedure DebugLogString;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringIntInt.spd,4)*/
procedure DebugLogStringIntInt
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringIntInt.spd,1)*/
; fpar
  str Charstring,
  val1 Integer,
  val2 Integer;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringIntInt.spd(1),122(55,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringIntInt.spd(1),119(55,50))*/
output /*#E*/ 
messageLog(call ConcatStringIntInt(str, val1, val2));
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringIntInt.spd(1),116(60,75))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\Debug\DebugLogStringIntInt.spd,4)*/
endprocedure DebugLogStringIntInt;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipTargetHeading.spd,4)*/
procedure SetShipTargetHeading
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipTargetHeading.spd,1)*/
; fpar
ShipId Integer,
TargetHeading tHeading;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipTargetHeading.spd(1),125(40,15))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipTargetHeading.spd(1),122(40,30))*/
task {/*#E*/ 
 
for (dcl i Integer := 1, i <= MaxShipId, i+1)
{
    if (CustomShipState(i)!ShipId = ShipId)
    {
        CustomShipState(i)!TargetHeading := TargetHeading;
        break;
    }
}
};
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipTargetHeading.spd(1),116(45,45))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipTargetHeading.spd,4)*/
endprocedure SetShipTargetHeading;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipTargetHeading,4)*/
procedure GetShipTargetHeading
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipTargetHeading,1)*/
; fpar
ShipId Integer;
returns TargetHeading tHeading;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipTargetHeading(1),125(40,15))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipTargetHeading(1),122(40,30))*/
task {/*#E*/ 
 
for (dcl i Integer := 1, i <= MaxShipId, i+1)
{
    if (CustomShipState(i)!ShipId = ShipId)
    {
        TargetHeading := CustomShipState(i)!TargetHeading;
        break;
    }
}
};
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipTargetHeading(1),116(45,45))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipTargetHeading,4)*/
endprocedure GetShipTargetHeading;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SetShipReadyToFreeMotion.spd,4)*/
procedure SetShipReadyToFreeMotion
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SetShipReadyToFreeMotion.spd,1)*/
; fpar
ShipId Integer,
Ready Boolean;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SetShipReadyToFreeMotion.spd(1),116(55,10))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SetShipReadyToFreeMotion.spd(1),119(55,25))*/
task {/*#E*/ 
 
for (dcl i Integer := 1, i <= MaxShipId, i+1)
{
    if (CustomShipState(i)!ShipId = ShipId)
    {
        CustomShipState(i)!ReadyToFreeMotion := Ready;
        break;
    }
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SetShipReadyToFreeMotion.spd(1),125(60,40))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\SetShipReadyToFreeMotion.spd,4)*/
endprocedure SetShipReadyToFreeMotion;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetShipReadyToFreeMotion.spd,4)*/
procedure GetShipReadyToFreeMotion
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetShipReadyToFreeMotion.spd,1)*/
; fpar
ShipId Integer;
returns Ready Boolean;

/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetShipReadyToFreeMotion.spd(1),125(55,20))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetShipReadyToFreeMotion.spd(1),122(55,35))*/
task {/*#E*/ 
 
for (dcl i Integer := 1, i <= MaxShipId, i+1)
{
    if (CustomShipState(i)!ShipId = ShipId)
    {
        Ready := CustomShipState(i)!ReadyToFreeMotion;
        break;
    }
}
};
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetShipReadyToFreeMotion.spd(1),116(60,50))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\Battleships\BattleShips\Strategy2\GetShipReadyToFreeMotion.spd,4)*/
endprocedure GetShipReadyToFreeMotion;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\InitCustomShipState,4)*/
procedure InitCustomShipState;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\InitCustomShipState(1),116(55,10))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\InitCustomShipState(1),119(55,25))*/
task {/*#E*/ 
 
for (dcl i Integer := 1, i <= length(ShipsCurrentState), i + 1)
{
    CustomShipState(i)!ShipId := ShipsCurrentState(i)!ShipId;
}
};
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\InitCustomShipState(1),122(60,40))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\InitCustomShipState,4)*/
endprocedure InitCustomShipState;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipPrevCoords,4)*/
procedure SetShipPrevCoords
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipPrevCoords,1)*/
; fpar
ShipId Integer,
PrevCoords tCoordinates;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipPrevCoords(1),125(55,25))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipPrevCoords(1),122(55,40))*/
task {/*#E*/ 
 
for (dcl i Integer := 1, i <= MaxShipId, i+1)
{
    if (CustomShipState(i)!ShipId = ShipId)
    {
        CustomShipState(i)!PrevCoords := PrevCoords;
        break;
    }
}
};
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipPrevCoords(1),116(60,55))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\SetShipPrevCoords,4)*/
endprocedure SetShipPrevCoords;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipPrevCoords.spd,4)*/
procedure GetShipPrevCoords
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipPrevCoords.spd,1)*/
; fpar
ShipId Integer;
returns PrevCoords tCoordinates;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipPrevCoords.spd(1),125(45,20))*/
start /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipPrevCoords.spd(1),122(45,35))*/
task {/*#E*/ 
 
for (dcl i Integer := 1, i <= MaxShipId, i+1)
{
    if (CustomShipState(i)!ShipId = ShipId)
    {
        PrevCoords := CustomShipState(i)!PrevCoords;
        break;
    }
}
};
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipPrevCoords.spd(1),116(50,50))*/
return /*#E*/ 
;
/*#SDTREF(SDL,C:\BattleShips\BattleShips\Strategy2\GetShipPrevCoords.spd,4)*/
endprocedure GetShipPrevCoords;
